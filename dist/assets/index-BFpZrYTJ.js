(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();class h{constructor(e){this.onColorSelect=e,this.modal=document.getElementById("colorPickerModal"),this.colorSquare=document.getElementById("colorSquare"),this.hueSlider=document.getElementById("hueSlider"),this.squareCursor=document.getElementById("squareCursor"),this.hueCursor=document.getElementById("hueCursor"),this.colorPreview=document.getElementById("selectedColorPreview"),this.squareCtx=this.colorSquare.getContext("2d",{willReadFrequently:!0}),this.hueCtx=this.hueSlider.getContext("2d"),this.currentHue=0,this.currentSaturation=100,this.currentBrightness=100,this.isDraggingSquare=!1,this.isDraggingHue=!1,this.initColorPicker(),this.setupEventListeners()}initColorPicker(){this.drawHueSlider(),this.drawColorSquare(),this.updateCursorPositions(),this.updateColorPreview()}drawHueSlider(){const e=this.hueSlider.width,t=this.hueSlider.height,s=this.hueCtx.createLinearGradient(0,0,0,t);for(let i=0;i<=360;i+=60)s.addColorStop(i/360,`hsl(${i}, 100%, 50%)`);this.hueCtx.fillStyle=s,this.hueCtx.fillRect(0,0,e,t)}drawColorSquare(){const e=this.colorSquare.width,t=this.colorSquare.height;this.squareCtx.fillStyle=`hsl(${this.currentHue}, 100%, 50%)`,this.squareCtx.fillRect(0,0,e,t);const s=this.squareCtx.createLinearGradient(0,0,e,0);s.addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),this.squareCtx.fillStyle=s,this.squareCtx.fillRect(0,0,e,t);const i=this.squareCtx.createLinearGradient(0,0,0,t);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 1)"),this.squareCtx.fillStyle=i,this.squareCtx.fillRect(0,0,e,t)}hsvToRgb(e,t,s){t/=100,s/=100;const i=s*t,r=i*(1-Math.abs(e/60%2-1)),n=s-i;let o,l,a;return e<60?(o=i,l=r,a=0):e<120?(o=r,l=i,a=0):e<180?(o=0,l=i,a=r):e<240?(o=0,l=r,a=i):e<300?(o=r,l=0,a=i):(o=i,l=0,a=r),{r:Math.round((o+n)*255),g:Math.round((l+n)*255),b:Math.round((a+n)*255)}}rgbToHex(e,t,s){return"#"+[e,t,s].map(i=>{const r=i.toString(16);return r.length===1?"0"+r:r}).join("")}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}updateColorPreview(){const e=this.hsvToRgb(this.currentHue,this.currentSaturation,this.currentBrightness),t=this.rgbToHex(e.r,e.g,e.b);this.colorPreview.style.backgroundColor=t,document.getElementById("hexInput").value=t,document.getElementById("rInput").value=e.r,document.getElementById("gInput").value=e.g,document.getElementById("bInput").value=e.b}updateCursorPositions(){const e=this.currentSaturation/100*this.colorSquare.width,t=(100-this.currentBrightness)/100*this.colorSquare.height;this.squareCursor.style.left=`${e}px`,this.squareCursor.style.top=`${t}px`;const s=this.currentHue/360*this.hueSlider.height;this.hueCursor.style.top=`${s}px`}handleSquareInteraction(e){const t=this.colorSquare.getBoundingClientRect(),s=Math.max(0,Math.min(e.clientX-t.left,this.colorSquare.width)),i=Math.max(0,Math.min(e.clientY-t.top,this.colorSquare.height));this.currentSaturation=s/this.colorSquare.width*100,this.currentBrightness=100-i/this.colorSquare.height*100,this.updateCursorPositions(),this.updateColorPreview()}handleHueInteraction(e){const t=this.hueSlider.getBoundingClientRect(),s=Math.max(0,Math.min(e.clientY-t.top,this.hueSlider.height));this.currentHue=s/this.hueSlider.height*360,this.drawColorSquare(),this.updateCursorPositions(),this.updateColorPreview()}setupEventListeners(){this.colorSquare.addEventListener("mousedown",e=>{this.isDraggingSquare=!0,this.handleSquareInteraction(e)}),document.addEventListener("mousemove",e=>{this.isDraggingSquare&&this.handleSquareInteraction(e),this.isDraggingHue&&this.handleHueInteraction(e)}),document.addEventListener("mouseup",()=>{this.isDraggingSquare=!1,this.isDraggingHue=!1}),this.hueSlider.addEventListener("mousedown",e=>{this.isDraggingHue=!0,this.handleHueInteraction(e)}),["rInput","gInput","bInput"].forEach(e=>{document.getElementById(e).addEventListener("input",()=>{const t=parseInt(document.getElementById("rInput").value)||0,s=parseInt(document.getElementById("gInput").value)||0,i=parseInt(document.getElementById("bInput").value)||0,r=this.rgbToHex(Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,s)),Math.max(0,Math.min(255,i)));document.getElementById("hexInput").value=r,this.colorPreview.style.backgroundColor=r})}),document.getElementById("hexInput").addEventListener("input",e=>{const t=e.target.value;if(/^#[0-9A-F]{6}$/i.test(t)){const s=this.hexToRgb(t);s&&(document.getElementById("rInput").value=s.r,document.getElementById("gInput").value=s.g,document.getElementById("bInput").value=s.b,this.colorPreview.style.backgroundColor=t)}}),document.getElementById("applyColorBtn").addEventListener("click",()=>{const e=document.getElementById("hexInput").value;this.onColorSelect(e),this.close()}),document.getElementById("cancelColorBtn").addEventListener("click",()=>{this.close()}),document.getElementById("closeColorPicker").addEventListener("click",()=>{this.close()}),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.close()})}open(e="#000000"){const t=this.hexToRgb(e);t&&(document.getElementById("rInput").value=t.r,document.getElementById("gInput").value=t.g,document.getElementById("bInput").value=t.b,document.getElementById("hexInput").value=e,this.colorPreview.style.backgroundColor=e),this.modal.classList.add("active")}close(){this.modal.classList.remove("active")}}class d{constructor(){this.canvas=document.getElementById("pixelCanvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.gridSize=16,this.pixelSize=20,this.brushSize=1,this.currentColor="#000000",this.isDrawing=!1,this.pixelData=[],this.recentColors=[],this.maxRecentColors=8,this.init(),this.setupEventListeners(),this.initColorPicker(),this.loadRecentColors()}initColorPicker(){this.colorPickerModal=new h(e=>{this.setColor(e)})}loadRecentColors(){const e=localStorage.getItem("pixelEditorRecentColors");if(e)try{this.recentColors=JSON.parse(e),this.renderRecentColors()}catch{this.recentColors=[]}}saveRecentColors(){localStorage.setItem("pixelEditorRecentColors",JSON.stringify(this.recentColors))}addRecentColor(e){const t=this.recentColors.indexOf(e);t>-1&&this.recentColors.splice(t,1),this.recentColors.unshift(e),this.recentColors.length>this.maxRecentColors&&(this.recentColors=this.recentColors.slice(0,this.maxRecentColors)),this.saveRecentColors(),this.renderRecentColors()}renderRecentColors(){const e=document.getElementById("recentColors");if(this.recentColors.length===0){e.innerHTML='<span class="no-recent-colors">No recent colors yet</span>';return}e.innerHTML="",this.recentColors.forEach((t,s)=>{const i=document.createElement("button");i.className="recent-color",i.style.setProperty("background-color",t,"important"),i.dataset.color=t,i.title=t,i.setAttribute("aria-label",t),i.addEventListener("click",r=>{r.preventDefault();const n=r.currentTarget.dataset.color;this.setColor(n)}),e.appendChild(i)})}init(){this.initializePixelData(),this.updateCanvasSize(),this.render()}initializePixelData(){this.pixelData=Array(this.gridSize).fill(null).map(()=>Array(this.gridSize).fill("#ffffff"))}updateCanvasSize(){const e=Math.min(600,window.innerWidth-400);this.pixelSize=Math.floor(e/this.gridSize),this.pixelSize<2&&(this.pixelSize=2);const t=this.gridSize*this.pixelSize;this.canvas.width=t,this.canvas.height=t}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e=0;e<this.gridSize;e++)for(let t=0;t<this.gridSize;t++)this.ctx.fillStyle=this.pixelData[e][t],this.ctx.fillRect(t*this.pixelSize,e*this.pixelSize,this.pixelSize,this.pixelSize);this.ctx.strokeStyle="#404040",this.ctx.lineWidth=1;for(let e=0;e<=this.gridSize;e++)this.ctx.beginPath(),this.ctx.moveTo(e*this.pixelSize,0),this.ctx.lineTo(e*this.pixelSize,this.canvas.height),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,e*this.pixelSize),this.ctx.lineTo(this.canvas.width,e*this.pixelSize),this.ctx.stroke()}getPixelCoordinates(e){const t=this.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-t.left)/this.pixelSize),i=Math.floor((e.clientY-t.top)/this.pixelSize);return{x:s,y:i}}drawPixel(e,t){if(e<0||e>=this.gridSize||t<0||t>=this.gridSize)return;const s=Math.floor(this.brushSize/2);for(let i=0;i<this.brushSize;i++)for(let r=0;r<this.brushSize;r++){const n=e-s+r,o=t-s+i;n>=0&&n<this.gridSize&&o>=0&&o<this.gridSize&&(this.pixelData[o][n]=this.currentColor)}this.render()}clearCanvas(){this.initializePixelData(),this.render()}exportImage(){const e=document.createElement("canvas");e.width=this.gridSize,e.height=this.gridSize;const t=e.getContext("2d");for(let s=0;s<this.gridSize;s++)for(let i=0;i<this.gridSize;i++)t.fillStyle=this.pixelData[s][i],t.fillRect(i,s,1,1);e.toBlob(s=>{const i=URL.createObjectURL(s),r=document.createElement("a");r.download=`pixel-art-${this.gridSize}x${this.gridSize}.png`,r.href=i,r.click(),URL.revokeObjectURL(i)})}setGridSize(e){this.gridSize=e,this.init()}setBrushSize(e){this.brushSize=e}setColor(e){this.currentColor=e,document.getElementById("colorDisplay").style.background=e,document.getElementById("colorPicker").value=e,this.addRecentColor(e)}setupEventListeners(){this.canvas.addEventListener("mousedown",e=>{this.isDrawing=!0;const{x:t,y:s}=this.getPixelCoordinates(e);this.drawPixel(t,s)}),this.canvas.addEventListener("mousemove",e=>{if(this.isDrawing){const{x:t,y:s}=this.getPixelCoordinates(e);this.drawPixel(t,s)}}),this.canvas.addEventListener("mouseup",()=>{this.isDrawing=!1}),this.canvas.addEventListener("mouseleave",()=>{this.isDrawing=!1}),this.canvas.addEventListener("touchstart",e=>{e.preventDefault(),this.isDrawing=!0;const t=e.touches[0],s=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY}),{x:i,y:r}=this.getPixelCoordinates(s);this.drawPixel(i,r)}),this.canvas.addEventListener("touchmove",e=>{if(e.preventDefault(),this.isDrawing){const t=e.touches[0],s=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY}),{x:i,y:r}=this.getPixelCoordinates(s);this.drawPixel(i,r)}}),this.canvas.addEventListener("touchend",e=>{e.preventDefault(),this.isDrawing=!1}),document.getElementById("canvasSize").addEventListener("change",e=>{this.setGridSize(parseInt(e.target.value))}),document.querySelectorAll(".brush-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".brush-btn").forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.setBrushSize(parseInt(e.dataset.size))})}),document.getElementById("colorPicker").addEventListener("input",e=>{this.currentColor=e.target.value,document.getElementById("colorDisplay").style.background=e.target.value}),document.getElementById("colorPicker").addEventListener("change",e=>{this.setColor(e.target.value)}),document.querySelectorAll(".preset-color").forEach(e=>{e.addEventListener("click",()=>{this.setColor(e.dataset.color)})}),document.getElementById("clearBtn").addEventListener("click",()=>{confirm("Are you sure you want to clear the canvas?")&&this.clearCanvas()}),document.getElementById("exportBtn").addEventListener("click",()=>{this.exportImage()}),window.addEventListener("resize",()=>{this.updateCanvasSize(),this.render()})}}document.addEventListener("DOMContentLoaded",()=>{new d});
